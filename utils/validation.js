const { MAX_FILE_SIZE, ALLOWED_FILE_TYPES } = require('../config/constants');

const validateFileUpload = (file) => {
  if (!file) {
    return { isValid: false, message: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î' };
  }

  if (file.size > MAX_FILE_SIZE) {
    return { 
      isValid: false, 
      message: `‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${MAX_FILE_SIZE / 1024 / 1024}MB)` 
    };
  }

  if (!ALLOWED_FILE_TYPES.includes(file.mimetype)) {
    return { 
      isValid: false, 
      message: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)' 
    };
  }

  return { isValid: true };
};

const validateStudentId = (studentId) => {
  if (!studentId || typeof studentId !== 'string') {
    return { isValid: false, message: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' };
  }

  if (studentId.length < 5) {
    return { isValid: false, message: '‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 5 ‡∏´‡∏•‡∏±‡∏Å' };
  }

  return { isValid: true };
};

const validateSubjectData = (subject) => {
  const errors = [];

  console.log(`üîç [Validation] Input data:`, subject);

  if (!subject.name || subject.name.trim() === '') {
    errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤');
  }

  if (!subject.class || subject.class.trim() === '') {
    errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô');
  }

  if (subject.maxScore) {
    console.log(`üîç [Validation] maxScore value: ${subject.maxScore}, type: ${typeof subject.maxScore}, isNaN: ${isNaN(subject.maxScore)}`);
    if (isNaN(subject.maxScore) || Number(subject.maxScore) <= 0) {
      errors.push('‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0');
    }
  }

  console.log(`üîç [Validation] Errors:`, errors);
  
  return {
    isValid: errors.length === 0,
    messages: errors
  };
};

const validateAssignmentData = (assignment) => {
  const errors = [];

  if (!assignment.title || assignment.title.trim() === '') {
    errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô');
  }

  if (!assignment.subjectId) {
    errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏¥‡∏ä‡∏≤');
  }

  return {
    isValid: errors.length === 0,
    messages: errors
  };
};

module.exports = {
  validateFileUpload,
  validateStudentId,
  validateSubjectData,
  validateAssignmentData
};